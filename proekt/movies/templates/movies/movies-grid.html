<div class="row g-2 mt-5">
    <div class="col-2">
        <label for="size" class="form-label">Page size</label>
        <select class="form-select" onchange="handleParamChange(event, 'size')" id="size">
            {% for size in sizes %}
                {% if size == paginator.per_page %}
                    <option value="{{ size }}" selected>{{ size }}</option>
                {% else %}
                    <option value="{{ size }}">{{ size }}</option>
                {% endif %}
            {% endfor %}
        </select>
    </div>
    <div class="col-2">
        <label for="order_by" class="form-label">Order by</label>
        <select class="form-select" onchange="handleParamChange(event, 'order_by')" id="order_by">
            {% if order_by == 'title' %}
                <option value="title" selected>By title</option>
            {% else %}
                <option value="title">By title</option>
            {% endif %}
            {% if order_by == '-title' %}
                <option value="-title" selected>By title desc</option>
            {% else %}
                <option value="-title">By title desc</option>
            {% endif %}
            {% if order_by == 'duration' %}
                <option value="duration" selected>By duration</option>
            {% else %}
                <option value="duration">By duration</option>
            {% endif %}
            {% if order_by == '-duration' %}
                <option value="-duration" selected>By duration desc</option>
            {% else %}
                <option value="-duration">By duration desc</option>
            {% endif %}
        </select>
    </div>
    <div class="col-2">
        <label for="title" class="form-label">Search</label>
        <input class="form-control" id="title" value="{{ filters.title }}" name="title"/>
    </div>
    <div class="col-2">
        <label for="min_duration" class="form-label">Min Duration</label>
        <input class="form-control" id="min_duration" value="{{ filters.min_duration }}" name="min_duration"/>
    </div>
    <div class="col-2">
        <label for="max_duration" class="form-label">Max Duration</label>
        <input class="form-control" id="max_duration" value="{{ filters.max_duration }}" name="max_duration"/>
    </div>
    <div class="col-2 d-flex align-items-end">
        <button class="btn btn-primary" onclick="handleFilterChange()">Apply Filter</button>
    </div>
</div>

<div class="row my-4 gx-5 gy-3">
    {% for movie in page_obj %}
    <div class="col-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{ movie.title }}</h5>
                <p class="card-text">{{ movie.description }}</p>
                <p class="card-text">{{ movie.duration }} minutes</p>
                <p class="card-text">{{ movie.producer }}</p>
                <a href="#" class="btn btn-primary">Go somewhere</a>
                <a href="{% url 'add_to_cart' pk=movie.id %}" class="d-block mt-4">
                    <button class="btn btn-primary">Add item</button>
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
    <div class="col-12">
        <nav class="d-flex justify-content-center align-items-center">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="javascript:void(0)"
                       onclick="handlePaginationChange(1)" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="javascript:void(0)"
                       onclick="handlePaginationChange({{page_obj.number|add:-1}})" aria-label="Previous">
                        <span aria-hidden="true"> < </span>
                    </a>
                </li>
                {% endif %}
                {% for page in paginator.page_range %}
                {% if page_obj.number == page %}
                <li class="page-item active"><a class="page-link" href="javascript:void(0)"
                                                onclick="handlePaginationChange({{page}})">{{ page }}</a></li>
                {% elif page >= page_obj.number|add:-2 and page <= page_obj.number|add:2 %}
                <li class="page-item"><a class="page-link" href="javascript:void(0)"
                                         onclick="handlePaginationChange({{page}})">{{ page }}</a></li>
                {% endif %}
                {% endfor %}
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="javascript:void(0)" aria-label="Next"
                       onclick="handlePaginationChange({{page_obj.number|add:1}})">
                        <span aria-hidden="true"> > </span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="javascript:void(0)" aria-label="Next"
                       onclick="handlePaginationChange({{paginator.num_pages}})">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    <script>
        const handlePaginationChange = (page) => {
            const params = (new URL(document.location)).searchParams;
            params.set('page', page)
            window.location.search = params.toString();
        }

        const handleParamChange = (event, name) => {
            console.log(event);
            const value = event.target.value;
            const params = (new URL(document.location)).searchParams;
            params.set(name, value)
            window.location.search = params.toString();
        }

        const handleFilterChange = () => {
            const params = (new URL(document.location)).searchParams;
            const title = document.getElementById('title').value;
            const min_duration = document.getElementById('min_duration').value;
            const max_duration = document.getElementById('max_duration').value;
            params.set('title', title)
            params.set('min_duration', min_duration)
            params.set('max_duration', max_duration)
            window.location.search = params.toString();
        }
    </script>
</div>
